<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Multi-View Replicator Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .pulse-dot {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .grid-transition {
            transition: all 0.3s ease;
        }
        .screen-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
        }
        .screen-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        .location-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }
        .browser-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .incognito-border {
            border: 2px solid transparent;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c) border-box;
            border-radius: 12px;
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
        }
        .glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .progress-bar {
            height: 4px;
            border-radius: 2px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        .tooltip {
            position: relative;
        }
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
            margin-bottom: 5px;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-6 p-4 glass-effect rounded-xl">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-3xl font-bold mb-2 bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">
                        YouTube Multi-View Replicator Pro
                    </h1>
                    <p class="text-gray-400">Master screen controls + Incognito mini-screens with enhanced features</p>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <div class="text-sm text-gray-400">Active Sessions</div>
                        <div class="text-2xl font-bold" id="activeSessions">0</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-400">Unique Locations</div>
                        <div class="text-2xl font-bold" id="uniqueLocations">0</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-400">Bandwidth</div>
                        <div class="text-2xl font-bold" id="bandwidthUsage">0 MB</div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Stats Bar -->
            <div class="flex flex-wrap gap-3 mt-4 pt-4 border-t border-gray-700 text-sm">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500"></div>
                    <span id="activeCount">0</span>
                    <span class="text-gray-400">Active</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-yellow-500 pulse-dot"></div>
                    <span id="loadingCount">0</span>
                    <span class="text-gray-400">Loading</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-red-500"></div>
                    <span id="errorCount">0</span>
                    <span class="text-gray-400">Error</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-purple-500"></div>
                    <span id="mutedCount">0</span>
                    <span class="text-gray-400">Muted</span>
                </div>
            </div>
        </div>

        <!-- Main Control Panel -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Master Screen Section -->
            <div class="lg:col-span-2">
                <div class="glass-effect rounded-xl p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">üé¨ Master Control Screen</h2>
                        <div class="flex gap-2">
                            <button id="syncAll" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors tooltip" data-tooltip="Sync all screens with master">
                                üîÑ Sync All
                            </button>
                            <button id="incognitoMode" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors tooltip" data-tooltip="Toggle incognito mode">
                                üï∂Ô∏è Enable Incognito
                            </button>
                            <button id="randomizeAll" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors tooltip" data-tooltip="Randomize all screen identities">
                                üé≤ Randomize All
                            </button>
                        </div>
                    </div>
                    
                    <!-- Master Screen URL Input -->
                    <div class="mb-4">
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                id="masterUrl" 
                                placeholder="Enter YouTube URL to replicate across all screens..."
                                value="https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                                class="flex-1 p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                            <button 
                                id="loadMaster"
                                class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold rounded-lg transition-all tooltip"
                                data-tooltip="Load video and replicate to all screens"
                            >
                                üöÄ Load & Replicate
                            </button>
                        </div>
                        <div class="flex items-center gap-2 mt-2">
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="autoMuteMaster" checked class="rounded">
                                <span>Mute master by default</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="autoPlayMaster" checked class="rounded">
                                <span>Auto-play master</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="loopVideo" class="rounded">
                                <span>Loop video</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Master Screen Display -->
                    <div class="mb-4">
                        <div class="screen-container bg-black rounded-lg overflow-hidden glow">
                            <iframe id="masterScreen" class="rounded-lg"></iframe>
                        </div>
                        <div class="mt-2 flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 rounded-full bg-green-500" id="masterStatusDot"></div>
                                <span class="text-sm">Master Screen</span>
                                <div class="flex gap-1">
                                    <button id="masterPlayPause" class="p-1 hover:bg-gray-700 rounded text-xs">
                                        ‚ñ∂
                                    </button>
                                    <button id="masterMute" class="p-1 hover:bg-gray-700 rounded text-xs">
                                        üîá
                                    </button>
                                    <button id="masterRefresh" class="p-1 hover:bg-gray-700 rounded text-xs">
                                        üîÑ
                                    </button>
                                </div>
                            </div>
                            <div class="text-sm text-gray-400">
                                <span id="masterStatus">Ready to load</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Replication Controls -->
                    <div class="glass-effect rounded-lg p-4">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-bold">üîÅ Replication Settings</h3>
                            <button id="applyToAll" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm">
                                Apply to All
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Mini-Screens Count</label>
                                <div class="flex items-center gap-2">
                                    <input 
                                        type="range" 
                                        id="miniScreenCount" 
                                        min="1" 
                                        max="16" 
                                        value="6"
                                        class="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                                    >
                                    <span id="countDisplay" class="font-bold text-lg min-w-[2rem] text-center">6</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Replication Delay</label>
                                <select id="replicationDelay" class="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg">
                                    <option value="100">Very Fast (100ms)</option>
                                    <option value="500">Fast (500ms)</option>
                                    <option value="1000" selected>Quick (1s)</option>
                                    <option value="2000">Natural (2s)</option>
                                    <option value="5000">Stealth (5s)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Quality</label>
                                <select id="videoQuality" class="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg">
                                    <option value="auto">Auto</option>
                                    <option value="hd1080">1080p</option>
                                    <option value="hd720">720p</option>
                                    <option value="large">480p</option>
                                    <option value="medium">360p</option>
                                    <option value="small">240p</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Incognito Mode</label>
                                <select id="incognitoLevel" class="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg">
                                    <option value="basic">Basic (Different Browsers)</option>
                                    <option value="advanced" selected>Advanced (Browser + Location)</option>
                                    <option value="stealth">Stealth (Full Identity)</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Advanced Settings -->
                        <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-2">
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="autoMuteAll" checked class="rounded">
                                <span>Auto-mute all screens</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="staggeredStart" checked class="rounded">
                                <span>Staggered start</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="autoRotate" class="rounded">
                                <span>Auto-rotate identities</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm">
                                <input type="checkbox" id="enableProxy" class="rounded">
                                <span>Enable proxy simulation</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Panel -->
            <div class="lg:col-span-1">
                <div class="glass-effect rounded-xl p-4 h-full">
                    <h2 class="text-xl font-bold mb-4">‚öôÔ∏è Enhanced Settings</h2>
                    
                    <!-- Location Settings -->
                    <div class="mb-6">
                        <h3 class="font-bold mb-3">üåç Geographic Distribution</h3>
                        <div class="space-y-2">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="randomLocations" checked class="rounded">
                                <span>Randomize locations</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="differentTimezones" checked class="rounded">
                                <span>Different timezones</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="languageVariation" class="rounded">
                                <span>Language variation</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="regionalContent" class="rounded">
                                <span>Regional content settings</span>
                            </label>
                        </div>
                        <div class="mt-3">
                            <label class="block text-sm font-medium mb-2">Location Pool Size</label>
                            <input 
                                type="range" 
                                id="locationPool" 
                                min="1" 
                                max="12" 
                                value="8"
                                class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                            >
                            <div class="flex justify-between text-xs text-gray-400 mt-1">
                                <span>Small</span>
                                <span id="locationPoolValue">8 locations</span>
                                <span>Large</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Browser Settings -->
                    <div class="mb-6">
                        <h3 class="font-bold mb-3">üåê Browser Diversity</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center gap-2 p-2 bg-gray-800 rounded">
                                <input type="checkbox" id="chrome" checked class="rounded">
                                <span>Chrome</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 bg-gray-800 rounded">
                                <input type="checkbox" id="firefox" checked class="rounded">
                                <span>Firefox</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 bg-gray-800 rounded">
                                <input type="checkbox" id="safari" class="rounded">
                                <span>Safari</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 bg-gray-800 rounded">
                                <input type="checkbox" id="edge" class="rounded">
                                <span>Edge</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 bg-gray-800 rounded">
                                <input type="checkbox" id="opera" class="rounded">
                                <span>Opera</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 bg-gray-800 rounded">
                                <input type="checkbox" id="mobile" class="rounded">
                                <span>Mobile</span>
                            </label>
                        </div>
                        <div class="mt-3">
                            <label class="block text-sm font-medium mb-2">Browser Version Spread</label>
                            <select id="versionSpread" class="w-full p-2 bg-gray-800 border border-gray-700 rounded-lg">
                                <option value="narrow">Narrow (latest only)</option>
                                <option value="medium" selected>Medium (6 months)</option>
                                <option value="wide">Wide (1 year)</option>
                                <option value="verywide">Very Wide (2 years)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div>
                        <h3 class="font-bold mb-3">‚ö° Quick Actions</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="playAll" class="p-3 bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
                                ‚ñ∂ Play All
                            </button>
                            <button id="pauseAll" class="p-3 bg-yellow-600 hover:bg-yellow-700 rounded-lg transition-colors">
                                ‚è∏Ô∏è Pause All
                            </button>
                            <button id="muteAll" class="p-3 bg-red-600 hover:bg-red-700 rounded-lg transition-colors">
                                üîá Mute All
                            </button>
                            <button id="unmuteAll" class="p-3 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                                üîä Unmute All
                            </button>
                            <button id="refreshAll" class="p-3 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors">
                                üîÑ Refresh All
                            </button>
                            <button id="randomizeAllBtn" class="p-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors">
                                üé≤ Randomize
                            </button>
                            <button id="stopAll" class="p-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                                ‚èπÔ∏è Stop All
                            </button>
                            <button id="exportSessions" class="p-3 bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">
                                üìä Export
                            </button>
                        </div>
                    </div>
                    
                    <!-- Stats -->
                    <div class="mt-6 pt-4 border-t border-gray-700">
                        <div class="text-sm space-y-2">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Total Sessions:</span>
                                <span id="totalSessions">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Unique Browsers:</span>
                                <span id="uniqueBrowsers">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Memory Usage:</span>
                                <span id="memoryUsage">0 MB</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">CPU Load:</span>
                                <span id="cpuLoad">Low</span>
                            </div>
                            <div class="mt-2">
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>System Load</span>
                                    <span id="loadPercent">0%</span>
                                </div>
                                <div class="w-full h-2 bg-gray-700 rounded-full overflow-hidden">
                                    <div id="loadProgress" class="progress-bar h-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mini-Screens Grid -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">üñ•Ô∏è Incognito Mini-Screens <span id="screenCountBadge" class="bg-purple-600 text-white px-2 py-1 rounded text-sm">0</span></h2>
                <div class="flex gap-2">
                    <button id="addScreen" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
                        ‚ûï Add Screen
                    </button>
                    <button id="removeScreen" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors">
                        ‚ûñ Remove Last
                    </button>
                    <button id="clearAll" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                        üóëÔ∏è Clear All
                    </button>
                    <button id="toggleGrid" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                        üîÄ Layout
                    </button>
                </div>
            </div>
            
            <div id="miniScreensGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 grid-transition">
                <!-- Mini-screens will be dynamically added here -->
            </div>
            
            <!-- Grid Controls -->
            <div class="mt-4 flex justify-center gap-2">
                <button id="prevPage" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded">
                    ‚óÄ Prev
                </button>
                <div class="flex items-center gap-2">
                    <span class="text-sm">Page</span>
                    <span id="currentPage" class="font-bold">1</span>
                    <span class="text-gray-400">/</span>
                    <span id="totalPages">1</span>
                </div>
                <button id="nextPage" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded">
                    Next ‚ñ∂
                </button>
            </div>
        </div>

        <!-- Session Monitor -->
        <div class="glass-effect rounded-xl p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">üìä Advanced Session Monitor</h2>
                <div class="flex gap-2">
                    <button id="toggleMonitor" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors">
                        üëÅÔ∏è Show Details
                    </button>
                    <button id="exportData" class="px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors">
                        üìã Export Data
                    </button>
                    <button id="autoRefresh" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                        üîÑ Auto-refresh
                    </button>
                </div>
            </div>
            
            <div id="sessionMonitor" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="sessionList">
                    <!-- Session details will be added here -->
                </div>
            </div>
            
            <!-- Summary Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 pt-4 border-t border-gray-700">
                <div class="text-center p-3 bg-gray-800 rounded-lg">
                    <div class="text-2xl font-bold text-green-400" id="summaryActive">0</div>
                    <div class="text-sm text-gray-400">Active</div>
                </div>
                <div class="text-center p-3 bg-gray-800 rounded-lg">
                    <div class="text-2xl font-bold text-yellow-400" id="summaryLoading">0</div>
                    <div class="text-sm text-gray-400">Loading</div>
                </div>
                <div class="text-center p-3 bg-gray-800 rounded-lg">
                    <div class="text-2xl font-bold text-red-400" id="summaryMuted">0</div>
                    <div class="text-sm text-gray-400">Muted</div>
                </div>
                <div class="text-center p-3 bg-gray-800 rounded-lg">
                    <div class="text-2xl font-bold text-purple-400" id="summaryIncognito">0</div>
                    <div class="text-sm text-gray-400">Incognito</div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="mt-6 p-4 glass-effect rounded-xl text-center text-sm text-gray-400">
            <p>YouTube Multi-View Replicator Pro v2.0 ‚Ä¢ All screens muted by default for optimal performance ‚Ä¢ Auto-saves settings</p>
            <div class="flex justify-center gap-4 mt-2">
                <button id="saveProfile" class="text-blue-400 hover:text-blue-300">üíæ Save Profile</button>
                <button id="loadProfile" class="text-green-400 hover:text-green-300">üìÇ Load Profile</button>
                <button id="resetSettings" class="text-red-400 hover:text-red-300">üîÑ Reset Settings</button>
                <button id="help" class="text-yellow-400 hover:text-yellow-300">‚ùì Help</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl p-6 max-w-lg w-full max-h-[80vh] overflow-y-auto">
                <h3 class="text-xl font-bold mb-4">‚öôÔ∏è Advanced Settings</h3>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-bold mb-2">Performance Settings</h4>
                        <div class="space-y-2">
                            <label class="flex items-center justify-between">
                                <span>Max screens per page</span>
                                <select id="maxScreensPage" class="bg-gray-700 rounded p-1">
                                    <option value="6">6</option>
                                    <option value="8">8</option>
                                    <option value="12" selected>12</option>
                                    <option value="16">16</option>
                                </select>
                            </label>
                            <label class="flex items-center justify-between">
                                <span>Auto-refresh interval</span>
                                <select id="refreshInterval" class="bg-gray-700 rounded p-1">
                                    <option value="0">Off</option>
                                    <option value="5000">5s</option>
                                    <option value="10000">10s</option>
                                    <option value="30000" selected>30s</option>
                                </select>
                            </label>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold mb-2">Privacy Settings</h4>
                        <div class="space-y-2">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="clearCookies" class="rounded">
                                <span>Clear cookies on refresh</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="disableTracking" checked class="rounded">
                                <span>Disable YouTube tracking</span>
                            </label>
                        </div>
                    </div>
                    <div class="flex gap-2 justify-end">
                        <button id="closeModal" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded">
                            Close
                        </button>
                        <button id="saveSettings" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class YouTubeReplicatorPro {
            constructor() {
                this.masterScreen = null;
                this.miniScreens = [];
                this.activeSessions = 0;
                this.uniqueLocations = new Set();
                this.uniqueBrowsers = new Set();
                this.isIncognitoMode = false;
                this.currentVideoId = null;
                this.masterLoaded = false;
                this.autoRefreshInterval = null;
                this.currentPage = 1;
                this.screensPerPage = 12;
                this.gridLayout = 'normal';
                this.autoRotateInterval = null;
                
                // Enhanced data pools
                this.locations = this.generateLocations();
                this.userAgents = this.generateUserAgents();
                this.languages = this.generateLanguages();
                this.timezones = this.generateTimezones();
                this.referrers = this.generateReferrers();
                
                // Performance tracking
                this.bandwidthUsed = 0;
                this.startTime = Date.now();
                this.sessionStats = {
                    totalViews: 0,
                    totalDuration: 0,
                    peakSessions: 0
                };
                
                this.initElements();
                this.bindEvents();
                this.updateStats();
                this.loadSettings();
                
                console.log('üé≠ YouTube Replicator Pro initialized');
                window.replicator = this;
            }
            
            initElements() {
                // Master screen elements
                this.masterUrl = document.getElementById('masterUrl');
                this.loadMasterBtn = document.getElementById('loadMaster');
                this.masterScreenEl = document.getElementById('masterScreen');
                this.masterStatus = document.getElementById('masterStatus');
                this.masterStatusDot = document.getElementById('masterStatusDot');
                this.masterPlayPause = document.getElementById('masterPlayPause');
                this.masterMute = document.getElementById('masterMute');
                this.masterRefresh = document.getElementById('masterRefresh');
                
                // Master settings
                this.autoMuteMaster = document.getElementById('autoMuteMaster');
                this.autoPlayMaster = document.getElementById('autoPlayMaster');
                this.loopVideo = document.getElementById('loopVideo');
                
                // Control elements
                this.miniScreenCount = document.getElementById('miniScreenCount');
                this.countDisplay = document.getElementById('countDisplay');
                this.replicationDelay = document.getElementById('replicationDelay');
                this.incognitoLevel = document.getElementById('incognitoLevel');
                this.videoQuality = document.getElementById('videoQuality');
                this.applyToAll = document.getElementById('applyToAll');
                this.randomizeAll = document.getElementById('randomizeAll');
                
                // Enhanced settings
                this.autoMuteAll = document.getElementById('autoMuteAll');
                this.staggeredStart = document.getElementById('staggeredStart');
                this.autoRotate = document.getElementById('autoRotate');
                this.enableProxy = document.getElementById('enableProxy');
                
                // Location settings
                this.randomLocations = document.getElementById('randomLocations');
                this.differentTimezones = document.getElementById('differentTimezones');
                this.languageVariation = document.getElementById('languageVariation');
                this.regionalContent = document.getElementById('regionalContent');
                this.locationPool = document.getElementById('locationPool');
                this.locationPoolValue = document.getElementById('locationPoolValue');
                
                // Browser settings
                this.browserCheckboxes = {
                    chrome: document.getElementById('chrome'),
                    firefox: document.getElementById('firefox'),
                    safari: document.getElementById('safari'),
                    edge: document.getElementById('edge'),
                    opera: document.getElementById('opera'),
                    mobile: document.getElementById('mobile')
                };
                this.versionSpread = document.getElementById('versionSpread');
                
                // Action buttons
                this.syncAllBtn = document.getElementById('syncAll');
                this.incognitoModeBtn = document.getElementById('incognitoMode');
                this.playAllBtn = document.getElementById('playAll');
                this.pauseAllBtn = document.getElementById('pauseAll');
                this.muteAllBtn = document.getElementById('muteAll');
                this.unmuteAllBtn = document.getElementById('unmuteAll');
                this.refreshAllBtn = document.getElementById('refreshAll');
                this.randomizeAllBtn = document.getElementById('randomizeAllBtn');
                this.stopAllBtn = document.getElementById('stopAll');
                this.exportSessionsBtn = document.getElementById('exportSessions');
                this.addScreenBtn = document.getElementById('addScreen');
                this.removeScreenBtn = document.getElementById('removeScreen');
                this.clearAllBtn = document.getElementById('clearAll');
                this.toggleMonitorBtn = document.getElementById('toggleMonitor');
                this.exportDataBtn = document.getElementById('exportData');
                this.autoRefreshBtn = document.getElementById('autoRefresh');
                this.toggleGridBtn = document.getElementById('toggleGrid');
                this.prevPageBtn = document.getElementById('prevPage');
                this.nextPageBtn = document.getElementById('nextPage');
                
                // Display elements
                this.miniScreensGrid = document.getElementById('miniScreensGrid');
                this.sessionMonitor = document.getElementById('sessionMonitor');
                this.sessionList = document.getElementById('sessionList');
                
                // Stats elements
                this.activeSessionsEl = document.getElementById('activeSessions');
                this.uniqueLocationsEl = document.getElementById('uniqueLocations');
                this.totalSessionsEl = document.getElementById('totalSessions');
                this.uniqueBrowsersEl = document.getElementById('uniqueBrowsers');
                this.memoryUsageEl = document.getElementById('memoryUsage');
                this.bandwidthUsageEl = document.getElementById('bandwidthUsage');
                this.cpuLoadEl = document.getElementById('cpuLoad');
                this.loadPercentEl = document.getElementById('loadPercent');
                this.loadProgress = document.getElementById('loadProgress');
                this.screenCountBadge = document.getElementById('screenCountBadge');
                this.currentPageEl = document.getElementById('currentPage');
                this.totalPagesEl = document.getElementById('totalPages');
                
                // Summary stats
                this.activeCount = document.getElementById('activeCount');
                this.loadingCount = document.getElementById('loadingCount');
                this.errorCount = document.getElementById('errorCount');
                this.mutedCount = document.getElementById('mutedCount');
                this.summaryActive = document.getElementById('summaryActive');
                this.summaryLoading = document.getElementById('summaryLoading');
                this.summaryMuted = document.getElementById('summaryMuted');
                this.summaryIncognito = document.getElementById('summaryIncognito');
                
                // Modal elements
                this.settingsModal = document.getElementById('settingsModal');
                this.closeModal = document.getElementById('closeModal');
                this.saveSettingsBtn = document.getElementById('saveSettings');
                this.maxScreensPage = document.getElementById('maxScreensPage');
                this.refreshInterval = document.getElementById('refreshInterval');
                this.clearCookies = document.getElementById('clearCookies');
                this.disableTracking = document.getElementById('disableTracking');
                
                // Footer buttons
                this.saveProfileBtn = document.getElementById('saveProfile');
                this.loadProfileBtn = document.getElementById('loadProfile');
                this.resetSettingsBtn = document.getElementById('resetSettings');
                this.helpBtn = document.getElementById('help');
            }
            
            bindEvents() {
                // Master screen controls
                this.loadMasterBtn.addEventListener('click', () => this.loadMasterScreen());
                this.masterUrl.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.loadMasterScreen();
                });
                this.masterPlayPause.addEventListener('click', () => this.toggleMasterPlayPause());
                this.masterMute.addEventListener('click', () => this.toggleMasterMute());
                this.masterRefresh.addEventListener('click', () => this.refreshMaster());
                
                // Mini-screen controls
                this.miniScreenCount.addEventListener('input', (e) => {
                    this.countDisplay.textContent = e.target.value;
                    this.updateMiniScreensCount();
                });
                
                this.locationPool.addEventListener('input', (e) => {
                    this.locationPoolValue.textContent = `${e.target.value} locations`;
                });
                
                // Action buttons
                this.syncAllBtn.addEventListener('click', () => this.syncAllScreens());
                this.incognitoModeBtn.addEventListener('click', () => this.toggleIncognitoMode());
                this.playAllBtn.addEventListener('click', () => this.playAllScreens());
                this.pauseAllBtn.addEventListener('click', () => this.pauseAllScreens());
                this.muteAllBtn.addEventListener('click', () => this.muteAllScreens());
                this.unmuteAllBtn.addEventListener('click', () => this.unmuteAllScreens());
                this.refreshAllBtn.addEventListener('click', () => this.refreshAllScreens());
                this.randomizeAll.addEventListener('click', () => this.randomizeAllIdentities());
                this.randomizeAllBtn.addEventListener('click', () => this.randomizeAllIdentities());
                this.stopAllBtn.addEventListener('click', () => this.stopAllScreens());
                this.exportSessionsBtn.addEventListener('click', () => this.exportSessionData());
                this.addScreenBtn.addEventListener('click', () => this.addMiniScreen());
                this.removeScreenBtn.addEventListener('click', () => this.removeMiniScreen());
                this.clearAllBtn.addEventListener('click', () => this.clearAllScreens());
                this.toggleMonitorBtn.addEventListener('click', () => this.toggleSessionMonitor());
                this.exportDataBtn.addEventListener('click', () => this.exportSessionData());
                this.autoRefreshBtn.addEventListener('click', () => this.toggleAutoRefresh());
                this.toggleGridBtn.addEventListener('click', () => this.toggleGridLayout());
                this.prevPageBtn.addEventListener('click', () => this.prevPage());
                this.nextPageBtn.addEventListener('click', () => this.nextPage());
                this.applyToAll.addEventListener('click', () => this.applySettingsToAll());
                
                // Auto-rotate feature
                this.autoRotate.addEventListener('change', () => {
                    if (this.autoRotate.checked) {
                        this.startAutoRotate();
                    } else {
                        this.stopAutoRotate();
                    }
                });
                
                // Modal controls
                this.closeModal.addEventListener('click', () => this.hideModal());
                this.saveSettingsBtn.addEventListener('click', () => this.saveAdvancedSettings());
                
                // Footer controls
                this.saveProfileBtn.addEventListener('click', () => this.saveProfile());
                this.loadProfileBtn.addEventListener('click', () => this.loadProfile());
                this.resetSettingsBtn.addEventListener('click', () => this.resetSettings());
                this.helpBtn.addEventListener('click', () => this.showHelp());
                
                // Auto-refresh stats
                setInterval(() => this.updatePerformanceStats(), 2000);
                
                // Handle page visibility
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.pauseAllScreens();
                    }
                });
            }
            
            generateLocations() {
                return [
                    { country: 'USA', city: 'New York', code: 'US', language: 'en-US', timezone: 'America/New_York', coordinates: '40.7128,-74.0060' },
                    { country: 'UK', city: 'London', code: 'GB', language: 'en-GB', timezone: 'Europe/London', coordinates: '51.5074,-0.1278' },
                    { country: 'Japan', city: 'Tokyo', code: 'JP', language: 'ja-JP', timezone: 'Asia/Tokyo', coordinates: '35.6762,139.6503' },
                    { country: 'Germany', city: 'Berlin', code: 'DE', language: 'de-DE', timezone: 'Europe/Berlin', coordinates: '52.5200,13.4050' },
                    { country: 'Australia', city: 'Sydney', code: 'AU', language: 'en-AU', timezone: 'Australia/Sydney', coordinates: '-33.8688,151.2093' },
                    { country: 'Canada', city: 'Toronto', code: 'CA', language: 'en-CA', timezone: 'America/Toronto', coordinates: '43.6510,-79.3470' },
                    { country: 'France', city: 'Paris', code: 'FR', language: 'fr-FR', timezone: 'Europe/Paris', coordinates: '48.8566,2.3522' },
                    { country: 'Brazil', city: 'S√£o Paulo', code: 'BR', language: 'pt-BR', timezone: 'America/Sao_Paulo', coordinates: '-23.5505,-46.6333' },
                    { country: 'India', city: 'Mumbai', code: 'IN', language: 'en-IN', timezone: 'Asia/Kolkata', coordinates: '19.0760,72.8777' },
                    { country: 'South Korea', city: 'Seoul', code: 'KR', language: 'ko-KR', timezone: 'Asia/Seoul', coordinates: '37.5665,126.9780' },
                    { country: 'Russia', city: 'Moscow', code: 'RU', language: 'ru-RU', timezone: 'Europe/Moscow', coordinates: '55.7558,37.6173' },
                    { country: 'Singapore', city: 'Singapore', code: 'SG', language: 'en-SG', timezone: 'Asia/Singapore', coordinates: '1.3521,103.8198' }
                ];
            }
            
            generateUserAgents() {
                return {
                    chrome: [
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36',
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36',
                        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                        'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
                    ],
                    firefox: [
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0',
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:120.0) Gecko/20100101 Firefox/120.0',
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:119.0) Gecko/20100101 Firefox/119.0',
                        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:121.0) Gecko/20100101 Firefox/121.0',
                        'Mozilla/5.0 (X11; Linux i686; rv:121.0) Gecko/20100101 Firefox/121.0'
                    ],
                    safari: [
                        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15',
                        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Safari/605.1.15',
                        'Mozilla/5.0 (iPhone; CPU iPhone OS 17_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1',
                        'Mozilla/5.0 (iPad; CPU OS 17_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1'
                    ],
                    edge: [
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0',
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0'
                    ],
                    opera: [
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 OPR/106.0.0.0',
                        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 OPR/105.0.0.0'
                    ],
                    mobile: [
                        'Mozilla/5.0 (iPhone; CPU iPhone OS 17_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1',
                        'Mozilla/5.0 (Android 14; Mobile; rv:121.0) Gecko/121.0 Firefox/121.0',
                        'Mozilla/5.0 (Linux; Android 14) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36',
                        'Mozilla/5.0 (iPad; CPU OS 17_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1'
                    ]
                };
            }
            
            generateLanguages() {
                return ['en-US', 'en-GB', 'es-ES', 'fr-FR', 'de-DE', 'ja-JP', 'ko-KR', 'zh-CN', 'ru-RU', 'pt-BR', 'ar-SA', 'hi-IN', 'it-IT', 'nl-NL', 'pl-PL'];
            }
            
            generateTimezones() {
                return ['UTC', 'EST', 'PST', 'CET', 'IST', 'JST', 'AEST', 'BRT', 'MSK', 'SGT', 'GMT', 'CST'];
            }
            
            generateReferrers() {
                return [
                    'https://www.google.com/',
                    'https://www.youtube.com/',
                    'https://www.facebook.com/',
                    'https://www.twitter.com/',
                    'https://www.reddit.com/',
                    'https://www.tiktok.com/',
                    'https://www.twitch.tv/',
                    'https://www.discord.com/',
                    'https://www.instagram.com/',
                    'https://www.linkedin.com/',
                    'https://www.pinterest.com/',
                    'https://www.tumblr.com/'
                ];
            }
            
            generateIncognitoIdentity(index) {
                const level = this.incognitoLevel.value;
                const identity = {
                    id: `incognito-${Date.now()}-${index}`,
                    browser: 'chrome',
                    location: { country: 'Unknown', city: 'Unknown', code: 'XX', coordinates: '0,0' },
                    userAgent: '',
                    language: 'en-US',
                    timezone: 'UTC',
                    referrer: 'https://www.google.com/',
                    isIncognito: this.isIncognitoMode,
                    screenResolution: this.getRandomScreenResolution(),
                    colorDepth: Math.random() > 0.5 ? 24 : 32,
                    platform: 'Win32'
                };
                
                // Select random enabled browser type
                const enabledBrowsers = Object.keys(this.browserCheckboxes).filter(browser => 
                    this.browserCheckboxes[browser].checked && this.userAgents[browser]
                );
                
                if (enabledBrowsers.length > 0) {
                    const browserType = enabledBrowsers[Math.floor(Math.random() * enabledBrowsers.length)];
                    identity.browser = browserType;
                    
                    // Get version based on spread setting
                    const versionSpread = this.versionSpread.value;
                    let userAgentList = this.userAgents[browserType];
                    
                    if (versionSpread === 'narrow') {
                        userAgentList = [userAgentList[0]];
                    } else if (versionSpread === 'medium') {
                        userAgentList = userAgentList.slice(0, 3);
                    } else if (versionSpread === 'wide') {
                        userAgentList = userAgentList.slice(0, 4);
                    }
                    
                    identity.userAgent = userAgentList[Math.floor(Math.random() * userAgentList.length)];
                    
                    // Set platform based on user agent
                    if (identity.userAgent.includes('Windows')) {
                        identity.platform = 'Win32';
                    } else if (identity.userAgent.includes('Mac')) {
                        identity.platform = 'MacIntel';
                    } else if (identity.userAgent.includes('Linux')) {
                        identity.platform = 'Linux x86_64';
                    } else if (identity.userAgent.includes('iPhone') || identity.userAgent.includes('iPad')) {
                        identity.platform = 'iPhone';
                        identity.screenResolution = this.getMobileScreenResolution();
                    } else if (identity.userAgent.includes('Android')) {
                        identity.platform = 'Android';
                        identity.screenResolution = this.getMobileScreenResolution();
                    }
                }
                
                // Add location if enabled
                if (this.randomLocations.checked && level !== 'basic') {
                    const poolSize = parseInt(this.locationPool.value);
                    const availableLocations = this.locations.slice(0, poolSize);
                    const location = availableLocations[Math.floor(Math.random() * availableLocations.length)];
                    identity.location = location;
                    identity.language = location.language;
                    identity.timezone = location.timezone;
                }
                
                // Add timezone variation
                if (this.differentTimezones.checked && level === 'stealth') {
                    identity.timezone = this.timezones[Math.floor(Math.random() * this.timezones.length)];
                }
                
                // Add language variation
                if (this.languageVariation.checked && level === 'stealth') {
                    identity.language = this.languages[Math.floor(Math.random() * this.languages.length)];
                }
                
                // Add random referrer
                identity.referrer = this.referrers[Math.floor(Math.random() * this.referrers.length)];
                
                return identity;
            }
            
            getRandomScreenResolution() {
                const resolutions = [
                    '1920x1080',
                    '1366x768',
                    '1536x864',
                    '1440x900',
                    '1600x900',
                    '1280x720',
                    '2560x1440',
                    '3840x2160'
                ];
                return resolutions[Math.floor(Math.random() * resolutions.length)];
            }
            
            getMobileScreenResolution() {
                const mobileResolutions = [
                    '375x667',
                    '414x896',
                    '360x640',
                    '412x915',
                    '390x844'
                ];
                return mobileResolutions[Math.floor(Math.random() * mobileResolutions.length)];
            }
            
            extractVideoId(url) {
                if (!url) return null;
                
                const patterns = [
                    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)([a-zA-Z0-9_-]{11})/,
                    /youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/,
                    /(?:v=|shorts\/)([a-zA-Z0-9_-]{11})/
                ];
                
                for (const pattern of patterns) {
                    const match = url.match(pattern);
                    if (match && match[1]) {
                        return match[1];
                    }
                }
                
                return null;
            }
            
            async loadMasterScreen() {
                const url = this.masterUrl.value.trim();
                if (!url) {
                    alert('Please enter a YouTube URL');
                    return;
                }
                
                const videoId = this.extractVideoId(url);
                if (!videoId) {
                    alert('Could not extract video ID. Please check the URL format.');
                    return;
                }
                
                this.currentVideoId = videoId;
                this.masterLoaded = false;
                this.masterStatus.textContent = 'Loading master screen...';
                this.masterStatusDot.className = 'w-3 h-3 rounded-full bg-yellow-500 pulse-dot';
                
                // Build master URL with settings
                const params = new URLSearchParams({
                    autoplay: this.autoPlayMaster.checked ? '1' : '0',
                    modestbranding: '1',
                    rel: '0',
                    enablejsapi: '1',
                    playsinline: '1',
                    controls: '1',
                    disablekb: '1'
                });
                
                if (this.loopVideo.checked) {
                    params.append('loop', '1');
                    params.append('playlist', videoId);
                }
                
                const embedUrl = `https://www.youtube.com/embed/${videoId}?${params.toString()}`;
                this.masterScreenEl.src = embedUrl;
                
                this.masterScreenEl.onload = () => {
                    this.masterLoaded = true;
                    this.masterStatus.textContent = 'Master screen loaded - ready to replicate';
                    this.masterStatusDot.className = 'w-3 h-3 rounded-full bg-green-500';
                    
                    // Auto-mute if enabled
                    if (this.autoMuteMaster.checked) {
                        setTimeout(() => this.muteMaster(), 1000);
                    }
                    
                    console.log('üé¨ Master screen loaded');
                    
                    // Start replicating to mini-screens
                    this.replicateToMiniScreens();
                };
                
                this.masterScreenEl.onerror = () => {
                    this.masterStatus.textContent = 'Error loading master screen';
                    this.masterStatusDot.className = 'w-3 h-3 rounded-full bg-red-500';
                    console.error('‚ùå Error loading master screen');
                };
            }
            
            async replicateToMiniScreens() {
                if (!this.masterLoaded || !this.currentVideoId) {
                    console.log('Master screen not loaded yet');
                    return;
                }
                
                const count = parseInt(this.miniScreenCount.value);
                const delay = parseInt(this.replicationDelay.value);
                const staggered = this.staggeredStart.checked;
                
                console.log(`üîÅ Replicating to ${count} mini-screens with ${delay}ms delay`);
                
                // Clear existing mini-screens
                this.clearAllScreens();
                
                // Create new mini-screens
                for (let i = 0; i < count; i++) {
                    await this.createMiniScreen(i);
                    if (staggered) {
                        await this.delay(delay);
                    }
                }
                
                console.log('‚úÖ All mini-screens created and replicating');
                this.updateStats();
            }
            
            async createMiniScreen(index) {
                return new Promise((resolve) => {
                    const identity = this.generateIncognitoIdentity(index);
                    const screenId = `mini-screen-${index}`;
                    const shouldMute = this.autoMuteAll.checked;
                    
                    // Create screen container
                    const screenDiv = document.createElement('div');
                    screenDiv.className = 'fade-in screen-item';
                    screenDiv.dataset.index = index;
                    screenDiv.innerHTML = `
                        <div class="relative rounded-xl overflow-hidden ${this.isIncognitoMode ? 'incognito-border' : 'glass-effect'}">
                            <!-- Screen Header -->
                            <div class="absolute top-0 left-0 right-0 z-10 p-2 bg-gradient-to-b from-black/90 to-transparent flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <div class="screen-status w-2 h-2 rounded-full bg-yellow-500 pulse-dot"></div>
                                    <span class="text-xs font-medium">Screen ${index + 1}</span>
                                    ${shouldMute ? '<span class="text-xs bg-red-600 px-1 rounded">MUTED</span>' : ''}
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="location-badge text-xs">${identity.location.city}</span>
                                    <span class="browser-badge text-xs">${identity.browser}</span>
                                </div>
                            </div>
                            
                            <!-- Screen Content -->
                            <div class="screen-container">
                                <iframe class="${this.isIncognitoMode ? 'incognito-border' : ''}" 
                                        title="Incognito Screen ${index + 1}"
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                        allowfullscreen></iframe>
                            </div>
                            
                            <!-- Screen Footer -->
                            <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/90 to-transparent">
                                <div class="flex justify-between items-center text-xs">
                                    <div class="flex items-center gap-1">
                                        <button class="p-1 hover:bg-gray-700 rounded" title="Play/Pause">
                                            ‚ñ∂
                                        </button>
                                        <button class="p-1 hover:bg-gray-700 rounded" title="${shouldMute ? 'Unmute' : 'Mute'}">
                                            ${shouldMute ? 'üîá' : 'üîä'}
                                        </button>
                                        <button class="p-1 hover:bg-gray-700 rounded" title="Refresh">
                                            üîÑ
                                        </button>
                                        <button class="p-1 hover:bg-gray-700 rounded" title="Randomize">
                                            üé≤
                                        </button>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-300">${identity.language}</span>
                                        <span class="text-gray-400 text-xs">${identity.screenResolution}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Add to grid
                    this.miniScreensGrid.appendChild(screenDiv);
                    
                    // Get iframe and load video
                    const iframe = screenDiv.querySelector('iframe');
                    
                    // Build unique URL with proper API parameters
                    const params = new URLSearchParams({
                        autoplay: '0',
                        modestbranding: '1',
                        rel: '0',
                        enablejsapi: '1',
                        widget_referrer: identity.referrer,
                        origin: window.location.origin,
                        hl: identity.language.split('-')[0],
                        playsinline: '1',
                        controls: '1',
                        disablekb: '1'
                    });
                    
                    // Add quality parameter if set
                    const quality = this.videoQuality.value;
                    if (quality !== 'auto') {
                        params.append('vq', quality);
                    }
                    
                    const embedUrl = `https://www.youtube.com/embed/${this.currentVideoId}?${params.toString()}`;
                    
                    // Set iframe attributes for better API compatibility
                    iframe.referrerPolicy = 'no-referrer-when-downgrade';
                    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-popups allow-presentation');
                    iframe.src = embedUrl;
                    
                    // Store screen data
                    const screenData = {
                        id: screenId,
                        element: screenDiv,
                        iframe: iframe,
                        index: index,
                        identity: identity,
                        loaded: false,
                        playing: false,
                        muted: shouldMute, // Default muted state
                        error: false
                    };
                    
                    this.miniScreens[index] = screenData;
                    this.activeSessions++;
                    this.uniqueLocations.add(identity.location.country);
                    this.uniqueBrowsers.add(identity.browser);
                    
                    // Set up event handlers for control buttons
                    const playBtn = screenDiv.querySelector('button[title="Play/Pause"]');
                    const muteBtn = screenDiv.querySelector('button[title^="Mute"]');
                    const refreshBtn = screenDiv.querySelector('button[title="Refresh"]');
                    const randomBtn = screenDiv.querySelector('button[title="Randomize"]');
                    
                    playBtn.addEventListener('click', () => this.togglePlayScreen(index));
                    muteBtn.addEventListener('click', () => this.toggleMuteScreen(index));
                    refreshBtn.addEventListener('click', () => this.refreshScreen(index));
                    randomBtn.addEventListener('click', () => this.randomizeIdentity(index));
                    
                    // Load detection
                    iframe.onload = () => {
                        const statusDot = screenDiv.querySelector('.screen-status');
                        if (statusDot) {
                            statusDot.classList.remove('bg-yellow-500', 'pulse-dot');
                            statusDot.classList.add('bg-green-500');
                        }
                        
                        screenData.loaded = true;
                        
                        // Auto-mute if enabled
                        if (shouldMute) {
                            setTimeout(() => this.muteScreen(index), 1000);
                        }
                        
                        // Auto-play if master is playing
                        if (this.autoPlayMaster.checked) {
                            setTimeout(() => this.playScreen(index), 1500);
                        }
                        
                        console.log(`‚úÖ Mini-screen ${index + 1} loaded from ${identity.location.city} on ${identity.browser}`);
                        
                        // Update stats
                        this.bandwidthUsed += 5; // Approximate MB per screen
                        this.updateStats();
                        this.updateSessionMonitor();
                        resolve();
                    };
                    
                    iframe.onerror = () => {
                        const statusDot = screenDiv.querySelector('.screen-status');
                        if (statusDot) {
                            statusDot.classList.remove('bg-yellow-500', 'pulse-dot');
                            statusDot.classList.add('bg-red-500');
                        }
                        screenData.error = true;
                        console.error(`‚ùå Error loading screen ${index + 1}`);
                        resolve();
                    };
                    
                    // Fallback timeout
                    setTimeout(() => {
                        if (!screenData.loaded && !screenData.error) {
                            const statusDot = screenDiv.querySelector('.screen-status');
                            if (statusDot) {
                                statusDot.classList.remove('bg-yellow-500', 'pulse-dot');
                                statusDot.classList.add('bg-green-500');
                            }
                            screenData.loaded = true;
                            resolve();
                        }
                    }, 15000);
                });
            }
            
            updateMiniScreensCount() {
                const currentCount = this.miniScreens.length;
                const targetCount = parseInt(this.miniScreenCount.value);
                
                if (targetCount > currentCount) {
                    // Add screens
                    for (let i = currentCount; i < targetCount; i++) {
                        this.addMiniScreen();
                    }
                } else if (targetCount < currentCount) {
                    // Remove screens
                    const screensToRemove = currentCount - targetCount;
                    for (let i = 0; i < screensToRemove; i++) {
                        this.removeMiniScreen();
                    }
                }
            }
            
            addMiniScreen() {
                const newIndex = this.miniScreens.length;
                if (newIndex >= 16) {
                    alert('Maximum 16 mini-screens allowed');
                    return;
                }
                
                if (this.currentVideoId) {
                    this.createMiniScreen(newIndex);
                } else {
                    alert('Please load a video in the master screen first');
                }
            }
            
            removeMiniScreen() {
                if (this.miniScreens.length > 0) {
                    const lastScreen = this.miniScreens.pop();
                    if (lastScreen && lastScreen.element) {
                        lastScreen.element.remove();
                        this.activeSessions--;
                        this.updateStats();
                        this.updateSessionMonitor();
                    }
                }
            }
            
            clearAllScreens() {
                this.miniScreensGrid.innerHTML = '';
                this.miniScreens = [];
                this.activeSessions = 0;
                this.uniqueLocations.clear();
                this.uniqueBrowsers.clear();
                this.updateStats();
                this.updateSessionMonitor();
            }
            
            toggleIncognitoMode() {
                this.isIncognitoMode = !this.isIncognitoMode;
                this.incognitoModeBtn.textContent = this.isIncognitoMode ? 'üï∂Ô∏è Incognito Active' : 'üï∂Ô∏è Enable Incognito Mode';
                this.incognitoModeBtn.classList.toggle('bg-purple-600', !this.isIncognitoMode);
                this.incognitoModeBtn.classList.toggle('bg-purple-800', this.isIncognitoMode);
                
                // Update all mini-screens with incognito styling
                this.miniScreens.forEach(screen => {
                    if (screen.element) {
                        const container = screen.element.querySelector('.relative');
                        const iframe = screen.element.querySelector('iframe');
                        
                        if (this.isIncognitoMode) {
                            container.classList.add('incognito-border');
                            container.classList.remove('glass-effect');
                            if (iframe) iframe.classList.add('incognito-border');
                        } else {
                            container.classList.remove('incognito-border');
                            container.classList.add('glass-effect');
                            if (iframe) iframe.classList.remove('incognito-border');
                        }
                    }
                });
                
                console.log(this.isIncognitoMode ? 'üï∂Ô∏è Incognito mode enabled' : 'üëÅÔ∏è Incognito mode disabled');
            }
            
            syncAllScreens() {
                if (!this.masterLoaded) {
                    alert('Please load the master screen first');
                    return;
                }
                
                console.log('üîÑ Syncing all mini-screens with master');
                
                this.miniScreens.forEach(screen => {
                    if (screen.loaded && screen.iframe.contentWindow) {
                        try {
                            const seekMessage = JSON.stringify({
                                event: 'command',
                                func: 'seekTo',
                                args: [0, true]
                            });
                            
                            const playMessage = JSON.stringify({
                                event: 'command',
                                func: 'playVideo',
                                args: ''
                            });
                            
                            setTimeout(() => {
                                screen.iframe.contentWindow.postMessage(seekMessage, 'https://www.youtube.com');
                            }, 100);
                            
                            setTimeout(() => {
                                screen.iframe.contentWindow.postMessage(playMessage, 'https://www.youtube.com');
                            }, 200);
                            
                        } catch (e) {
                            console.warn('Error syncing screen, falling back to refresh:', e);
                        }
                    }
                });
                
                this.updateSessionMonitor();
            }
            
            playAllScreens() {
                this.miniScreens.forEach(screen => {
                    this.playScreen(screen.index);
                });
                console.log('‚ñ∂ Playing all screens');
            }
            
            pauseAllScreens() {
                this.miniScreens.forEach(screen => {
                    this.pauseScreen(screen.index);
                });
                console.log('‚è∏Ô∏è Pausing all screens');
            }
            
            muteAllScreens() {
                this.miniScreens.forEach(screen => {
                    this.muteScreen(screen.index);
                });
                console.log('üîá Muting all screens');
            }
            
            unmuteAllScreens() {
                this.miniScreens.forEach(screen => {
                    this.unmuteScreen(screen.index);
                });
                console.log('üîä Unmuting all screens');
            }
            
            stopAllScreens() {
                this.miniScreens.forEach(screen => {
                    this.pauseScreen(screen.index);
                    this.muteScreen(screen.index);
                });
                console.log('‚èπÔ∏è Stopping all screens');
            }
            
            refreshAllScreens() {
                this.miniScreens.forEach(screen => {
                    this.refreshScreen(screen.index);
                });
                console.log('üîÑ Refreshing all screens');
            }
            
            randomizeAllIdentities() {
                this.miniScreens.forEach(screen => {
                    this.randomizeIdentity(screen.index);
                });
                console.log('üé≤ Randomized all identities');
            }
            
            playScreen(index) {
                const screen = this.miniScreens[index];
                if (screen && screen.loaded && screen.iframe.contentWindow) {
                    try {
                        const message = JSON.stringify({
                            event: 'command',
                            func: 'playVideo',
                            args: ''
                        });
                        screen.iframe.contentWindow.postMessage(message, 'https://www.youtube.com');
                    } catch (e) {
                        console.warn('Error playing screen:', e);
                    }
                    screen.playing = true;
                    this.updateSessionMonitor();
                }
            }
            
            pauseScreen(index) {
                const screen = this.miniScreens[index];
                if (screen && screen.loaded && screen.iframe.contentWindow) {
                    try {
                        const message = JSON.stringify({
                            event: 'command',
                            func: 'pauseVideo',
                            args: ''
                        });
                        screen.iframe.contentWindow.postMessage(message, 'https://www.youtube.com');
                    } catch (e) {
                        console.warn('Error pausing screen:', e);
                    }
                    screen.playing = false;
                    this.updateSessionMonitor();
                }
            }
            
            togglePlayScreen(index) {
                const screen = this.miniScreens[index];
                if (screen) {
                    if (screen.playing) {
                        this.pauseScreen(index);
                    } else {
                        this.playScreen(index);
                    }
                }
            }
            
            muteScreen(index) {
                const screen = this.miniScreens[index];
                if (screen && screen.loaded && screen.iframe.contentWindow) {
                    try {
                        const message = JSON.stringify({
                            event: 'command',
                            func: 'mute',
                            args: ''
                        });
                        screen.iframe.contentWindow.postMessage(message, 'https://www.youtube.com');
                    } catch (e) {
                        console.warn('Error muting screen:', e);
                    }
                    screen.muted = true;
                    this.updateButtonIcon(index, 'mute', 'üîá');
                    this.updateSessionMonitor();
                }
            }
            
            unmuteScreen(index) {
                const screen = this.miniScreens[index];
                if (screen && screen.loaded && screen.iframe.contentWindow) {
                    try {
                        const message = JSON.stringify({
                            event: 'command',
                            func: 'unMute',
                            args: ''
                        });
                        screen.iframe.contentWindow.postMessage(message, 'https://www.youtube.com');
                    } catch (e) {
                        console.warn('Error unmuting screen:', e);
                    }
                    screen.muted = false;
                    this.updateButtonIcon(index, 'mute', 'üîä');
                    this.updateSessionMonitor();
                }
            }
            
            toggleMuteScreen(index) {
                const screen = this.miniScreens[index];
                if (screen) {
                    if (screen.muted) {
                        this.unmuteScreen(index);
                    } else {
                        this.muteScreen(index);
                    }
                }
            }
            
            refreshScreen(index) {
                const screen = this.miniScreens[index];
                if (screen && screen.loaded) {
                    // Refresh iframe
                    screen.iframe.src = screen.iframe.src;
                    
                    // Reset status
                    const statusDot = screen.element.querySelector('.screen-status');
                    if (statusDot) {
                        statusDot.classList.remove('bg-green-500', 'bg-red-500');
                        statusDot.classList.add('bg-yellow-500', 'pulse-dot');
                    }
                    
                    screen.loaded = false;
                    console.log(`üîÑ Refreshed screen ${index + 1}`);
                }
            }
            
            randomizeIdentity(index) {
                const screen = this.miniScreens[index];
                if (screen) {
                    const newIdentity = this.generateIncognitoIdentity(index);
                    screen.identity = newIdentity;
                    
                    // Update UI
                    const locationBadge = screen.element.querySelector('.location-badge');
                    const browserBadge = screen.element.querySelector('.browser-badge');
                    const languageSpan = screen.element.querySelector('.text-gray-300');
                    const resolutionSpan = screen.element.querySelector('.text-gray-400');
                    
                    if (locationBadge) locationBadge.textContent = newIdentity.location.city;
                    if (browserBadge) browserBadge.textContent = newIdentity.browser;
                    if (languageSpan) languageSpan.textContent = newIdentity.language;
                    if (resolutionSpan) resolutionSpan.textContent = newIdentity.screenResolution;
                    
                    console.log(`üé≤ Randomized identity for screen ${index + 1}`);
                }
            }
            
            updateButtonIcon(index, buttonType, icon) {
                const screen = this.miniScreens[index];
                if (screen && screen.element) {
                    let button;
                    if (buttonType === 'mute') {
                        button = screen.element.querySelector('button[title^="Mute"], button[title^="Unmute"]');
                        if (button) {
                            button.innerHTML = icon;
                            button.title = icon === 'üîá' ? 'Unmute' : 'Mute';
                        }
                    }
                }
            }
            
            // Master screen controls
            toggleMasterPlayPause() {
                if (this.masterLoaded) {
                    // Toggle master play/pause
                    console.log('Master play/pause toggled');
                }
            }
            
            toggleMasterMute() {
                if (this.masterLoaded) {
                    // Toggle master mute
                    console.log('Master mute toggled');
                }
            }
            
            muteMaster() {
                if (this.masterLoaded) {
                    console.log('Master muted');
                }
            }
            
            refreshMaster() {
                if (this.currentVideoId) {
                    this.loadMasterScreen();
                }
            }
            
            // Page navigation
            updatePageNavigation() {
                const totalScreens = this.miniScreens.length;
                const totalPages = Math.ceil(totalScreens / this.screensPerPage);
                
                this.currentPageEl.textContent = this.currentPage;
                this.totalPagesEl.textContent = totalPages;
                
                // Show/hide navigation buttons
                this.prevPageBtn.disabled = this.currentPage === 1;
                this.nextPageBtn.disabled = this.currentPage === totalPages || totalPages === 0;
                
                // Update grid display
                this.updateGridDisplay();
            }
            
            prevPage() {
                if (this.currentPage > 1) {
                    this.currentPage--;
                    this.updatePageNavigation();
                }
            }
            
            nextPage() {
                const totalPages = Math.ceil(this.miniScreens.length / this.screensPerPage);
                if (this.currentPage < totalPages) {
                    this.currentPage++;
                    this.updatePageNavigation();
                }
            }
            
            updateGridDisplay() {
                const startIdx = (this.currentPage - 1) * this.screensPerPage;
                const endIdx = startIdx + this.screensPerPage;
                
                // Hide all screens
                document.querySelectorAll('.screen-item').forEach(item => {
                    item.classList.add('hidden');
                });
                
                // Show screens for current page
                for (let i = startIdx; i < endIdx && i < this.miniScreens.length; i++) {
                    if (this.miniScreens[i] && this.miniScreens[i].element) {
                        this.miniScreens[i].element.classList.remove('hidden');
                    }
                }
            }
            
            toggleGridLayout() {
                const layouts = ['normal', 'compact', 'expanded'];
                const currentIndex = layouts.indexOf(this.gridLayout);
                this.gridLayout = layouts[(currentIndex + 1) % layouts.length];
                
                // Update grid classes
                this.miniScreensGrid.className = 'grid gap-4 grid-transition';
                
                switch(this.gridLayout) {
                    case 'compact':
                        this.miniScreensGrid.classList.add('grid-cols-2', 'sm:grid-cols-3', 'md:grid-cols-4', 'lg:grid-cols-6', 'xl:grid-cols-8');
                        break;
                    case 'expanded':
                        this.miniScreensGrid.classList.add('grid-cols-1', 'sm:grid-cols-2', 'md:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');
                        break;
                    default:
                        this.miniScreensGrid.classList.add('grid-cols-1', 'sm:grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4', 'xl:grid-cols-6');
                }
                
                this.toggleGridBtn.textContent = this.gridLayout === 'normal' ? 'üîÄ Layout' : 
                                                this.gridLayout === 'compact' ? 'üîÄ Compact' : 'üîÄ Expanded';
            }
            
            // Auto-rotate feature
            startAutoRotate() {
                this.stopAutoRotate();
                this.autoRotateInterval = setInterval(() => {
                    this.randomizeAllIdentities();
                }, 30000); // Rotate every 30 seconds
                console.log('üîÑ Auto-rotate enabled');
            }
            
            stopAutoRotate() {
                if (this.autoRotateInterval) {
                    clearInterval(this.autoRotateInterval);
                    this.autoRotateInterval = null;
                    console.log('‚èπÔ∏è Auto-rotate disabled');
                }
            }
            
            // Auto-refresh feature
            toggleAutoRefresh() {
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                    this.autoRefreshInterval = null;
                    this.autoRefreshBtn.textContent = 'üîÑ Auto-refresh';
                    console.log('‚èπÔ∏è Auto-refresh disabled');
                } else {
                    const interval = parseInt(this.refreshInterval.value);
                    if (interval > 0) {
                        this.autoRefreshInterval = setInterval(() => {
                            this.refreshAllScreens();
                        }, interval);
                        this.autoRefreshBtn.textContent = 'üîÑ Auto-refresh ON';
                        console.log(`üîÑ Auto-refresh enabled (${interval}ms)`);
                    }
                }
            }
            
            // Settings management
            applySettingsToAll() {
                // Apply current settings to all screens
                this.miniScreens.forEach(screen => {
                    if (screen.loaded) {
                        // Apply mute setting
                        if (this.autoMuteAll.checked && !screen.muted) {
                            this.muteScreen(screen.index);
                        } else if (!this.autoMuteAll.checked && screen.muted) {
                            this.unmuteScreen(screen.index);
                        }
                    }
                });
                console.log('‚úÖ Settings applied to all screens');
            }
            
            updateSessionMonitor() {
                this.sessionList.innerHTML = '';
                
                let activeCount = 0;
                let loadingCount = 0;
                let mutedCount = 0;
                let errorCount = 0;
                
                this.miniScreens.forEach(screen => {
                    if (screen && screen.loaded) {
                        if (screen.playing) activeCount++;
                        if (screen.muted) mutedCount++;
                        if (screen.error) errorCount++;
                        
                        const sessionCard = document.createElement('div');
                        sessionCard.className = 'glass-effect p-4 rounded-lg slide-in';
                        sessionCard.innerHTML = `
                            <div class="flex justify-between items-center mb-3">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full ${screen.playing ? 'bg-green-500' : 'bg-yellow-500'}"></div>
                                    <span class="font-medium">Screen ${screen.index + 1}</span>
                                </div>
                                <div class="flex gap-1">
                                    <span class="text-xs ${screen.muted ? 'bg-red-600' : 'bg-green-600'} px-2 py-1 rounded">
                                        ${screen.muted ? 'üîá' : 'üîä'}
                                    </span>
                                    <span class="text-xs bg-blue-600 px-2 py-1 rounded">
                                        ${screen.identity.browser}
                                    </span>
                                </div>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Location:</span>
                                    <span>${screen.identity.location.city}, ${screen.identity.location.country}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Language:</span>
                                    <span>${screen.identity.language}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Resolution:</span>
                                    <span>${screen.identity.screenResolution}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Status:</span>
                                    <span>${screen.playing ? '‚ñ∂ Playing' : '‚è∏Ô∏è Paused'}</span>
                                </div>
                            </div>
                            <div class="mt-3 flex gap-2">
                                <button class="flex-1 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs" 
                                        onclick="window.replicator.togglePlayScreen(${screen.index})">
                                    ${screen.playing ? '‚è∏Ô∏è' : '‚ñ∂'}
                                </button>
                                <button class="flex-1 py-1 ${screen.muted ? 'bg-green-600' : 'bg-red-600'} hover:opacity-90 rounded text-xs"
                                        onclick="window.replicator.toggleMuteScreen(${screen.index})">
                                    ${screen.muted ? 'üîä' : 'üîá'}
                                </button>
                                <button class="flex-1 py-1 bg-purple-600 hover:bg-purple-700 rounded text-xs"
                                        onclick="window.replicator.refreshScreen(${screen.index})">
                                    üîÑ
                                </button>
                            </div>
                        `;
                        this.sessionList.appendChild(sessionCard);
                    } else if (screen && !screen.loaded && !screen.error) {
                        loadingCount++;
                    } else if (screen && screen.error) {
                        errorCount++;
                    }
                });
                
                // Update summary counts
                this.activeCount.textContent = activeCount;
                this.loadingCount.textContent = loadingCount;
                this.errorCount.textContent = errorCount;
                this.mutedCount.textContent = mutedCount;
                
                this.summaryActive.textContent = activeCount;
                this.summaryLoading.textContent = loadingCount;
                this.summaryMuted.textContent = mutedCount;
                this.summaryIncognito.textContent = this.miniScreens.filter(s => s && s.identity.isIncognito).length;
            }
            
            toggleSessionMonitor() {
                const isVisible = !this.sessionMonitor.classList.contains('hidden');
                this.sessionMonitor.classList.toggle('hidden');
                this.toggleMonitorBtn.textContent = isVisible ? 'üëÅÔ∏è Show Details' : 'üëÅÔ∏è Hide Details';
            }
            
            updateStats() {
                this.activeSessionsEl.textContent = this.miniScreens.length;
                this.uniqueLocationsEl.textContent = this.uniqueLocations.size;
                this.totalSessionsEl.textContent = this.miniScreens.length;
                this.uniqueBrowsersEl.textContent = this.uniqueBrowsers.size;
                this.bandwidthUsageEl.textContent = `${this.bandwidthUsed} MB`;
                
                // Estimate memory usage
                const memoryUsage = this.miniScreens.length * 75; // ~75MB per screen
                this.memoryUsageEl.textContent = `${memoryUsage} MB`;
                
                // Update screen count badge
                this.screenCountBadge.textContent = this.miniScreens.length;
                
                // Update page navigation
                this.updatePageNavigation();
            }
            
            updatePerformanceStats() {
                // Simulate CPU load based on active screens
                const load = Math.min(this.miniScreens.length * 8, 100);
                this.loadPercentEl.textContent = `${load}%`;
                this.loadProgress.style.width = `${load}%`;
                
                // Update CPU load text
                if (load < 30) this.cpuLoadEl.textContent = 'Low';
                else if (load < 60) this.cpuLoadEl.textContent = 'Medium';
                else if (load < 80) this.cpuLoadEl.textContent = 'High';
                else this.cpuLoadEl.textContent = 'Very High';
                
                // Update session stats
                this.sessionStats.totalViews += this.miniScreens.filter(s => s && s.playing).length;
                this.sessionStats.peakSessions = Math.max(this.sessionStats.peakSessions, this.miniScreens.length);
                this.sessionStats.totalDuration = Math.floor((Date.now() - this.startTime) / 1000);
            }
            
            exportSessionData() {
                const data = {
                    timestamp: new Date().toISOString(),
                    masterUrl: this.masterUrl.value,
                    totalScreens: this.miniScreens.length,
                    settings: {
                        incognitoMode: this.isIncognitoMode,
                        autoMute: this.autoMuteAll.checked,
                        quality: this.videoQuality.value,
                        incognitoLevel: this.incognitoLevel.value
                    },
                    screens: this.miniScreens.map(screen => ({
                        id: screen.id,
                        index: screen.index,
                        identity: screen.identity,
                        playing: screen.playing,
                        muted: screen.muted,
                        loaded: screen.loaded
                    })),
                    stats: this.sessionStats
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `youtube-replicator-session-${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('üìä Session data exported');
            }
            
            // Settings management
            loadSettings() {
                const saved = localStorage.getItem('youtubeReplicatorSettings');
                if (saved) {
                    try {
                        const settings = JSON.parse(saved);
                        // Load settings here
                        console.log('Settings loaded from localStorage');
                    } catch (e) {
                        console.warn('Failed to load settings:', e);
                    }
                }
            }
            
            saveProfile() {
                const profile = {
                    version: '2.0',
                    timestamp: new Date().toISOString(),
                    masterUrl: this.masterUrl.value,
                    settings: {
                        miniScreenCount: this.miniScreenCount.value,
                        replicationDelay: this.replicationDelay.value,
                        incognitoLevel: this.incognitoLevel.value,
                        videoQuality: this.videoQuality.value,
                        autoMuteAll: this.autoMuteAll.checked,
                        autoMuteMaster: this.autoMuteMaster.checked,
                        autoPlayMaster: this.autoPlayMaster.checked,
                        randomLocations: this.randomLocations.checked,
                        differentTimezones: this.differentTimezones.checked,
                        languageVariation: this.languageVariation.checked
                    }
                };
                
                const dataStr = JSON.stringify(profile, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `youtube-replicator-profile-${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('üíæ Profile saved');
            }
            
            loadProfile() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const profile = JSON.parse(event.target.result);
                            if (profile.version === '2.0') {
                                // Apply profile settings
                                this.masterUrl.value = profile.masterUrl || '';
                                this.miniScreenCount.value = profile.settings.miniScreenCount || 6;
                                this.countDisplay.textContent = profile.settings.miniScreenCount || 6;
                                this.replicationDelay.value = profile.settings.replicationDelay || 1000;
                                this.incognitoLevel.value = profile.settings.incognitoLevel || 'advanced';
                                this.videoQuality.value = profile.settings.videoQuality || 'auto';
                                this.autoMuteAll.checked = profile.settings.autoMuteAll !== false;
                                this.autoMuteMaster.checked = profile.settings.autoMuteMaster !== false;
                                this.autoPlayMaster.checked = profile.settings.autoPlayMaster !== false;
                                this.randomLocations.checked = profile.settings.randomLocations !== false;
                                this.differentTimezones.checked = profile.settings.differentTimezones !== false;
                                this.languageVariation.checked = profile.settings.languageVariation || false;
                                
                                console.log('üìÇ Profile loaded');
                                alert('Profile loaded successfully! Click "Load & Replicate" to apply.');
                            } else {
                                alert('Invalid profile version');
                            }
                        } catch (e) {
                            alert('Error loading profile: ' + e.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }
            
            resetSettings() {
                if (confirm('Are you sure you want to reset all settings to default?')) {
                    // Reset to defaults
                    this.miniScreenCount.value = 6;
                    this.countDisplay.textContent = 6;
                    this.replicationDelay.value = 1000;
                    this.incognitoLevel.value = 'advanced';
                    this.videoQuality.value = 'auto';
                    this.autoMuteAll.checked = true;
                    this.autoMuteMaster.checked = true;
                    this.autoPlayMaster.checked = true;
                    this.randomLocations.checked = true;
                    this.differentTimezones.checked = true;
                    this.languageVariation.checked = false;
                    this.autoRotate.checked = false;
                    this.staggeredStart.checked = true;
                    
                    // Reset browser checkboxes
                    Object.keys(this.browserCheckboxes).forEach(key => {
                        this.browserCheckboxes[key].checked = key === 'chrome' || key === 'firefox';
                    });
                    
                    console.log('üîÑ Settings reset to default');
                    alert('Settings have been reset to default values.');
                }
            }
            
            showHelp() {
                alert(`YouTube Multi-View Replicator Pro v2.0\n\nFeatures:\n‚Ä¢ Load one YouTube video and replicate to multiple screens\n‚Ä¢ All screens muted by default for optimal performance\n‚Ä¢ Advanced incognito identity simulation\n‚Ä¢ Geographic location randomization\n‚Ä¢ Browser diversity simulation\n‚Ä¢ Performance monitoring\n‚Ä¢ Export session data\n‚Ä¢ Save/load profiles\n\nTips:\n‚Ä¢ Start with 4-6 screens for best performance\n‚Ä¢ Use "Auto-mute all screens" for silent operation\n‚Ä¢ Export data for analytics\n‚Ä¢ Save profiles for different use cases`);
            }
            
            // Modal controls
            showModal() {
                this.settingsModal.classList.remove('hidden');
            }
            
            hideModal() {
                this.settingsModal.classList.add('hidden');
            }
            
            saveAdvancedSettings() {
                this.screensPerPage = parseInt(this.maxScreensPage.value);
                this.updatePageNavigation();
                this.hideModal();
                console.log('‚öôÔ∏è Advanced settings saved');
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            const replicator = new YouTubeReplicatorPro();
            
            // Auto-load example after 1 second
            setTimeout(() => {
                console.log('üé¨ Auto-loading example...');
                replicator.loadMasterScreen();
            }, 1000);
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl+S to save profile
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    replicator.saveProfile();
                }
                // Ctrl+L to load profile
                if (e.ctrlKey && e.key === 'l') {
                    e.preventDefault();
                    replicator.loadProfile();
                }
                // Space to play/pause all
                if (e.code === 'Space' && e.target === document.body) {
                    e.preventDefault();
                    const anyPlaying = replicator.miniScreens.some(s => s && s.playing);
                    if (anyPlaying) {
                        replicator.pauseAllScreens();
                    } else {
                        replicator.playAllScreens();
                    }
                }
            });
        });
    </script>
</body>
</html>
